require 'fileutils'

task :default => :test

task :test => :build do
  in_fixture_copy { sh "../test/Debug/UpdateInstallerTest.exe" }
  in_fixture_copy { ruby "../update_installer_test.rb" }
end

task :build do
  devenv "UpdateInstaller.vcproj", :build, "Release"
  FileUtils.cd "test" do
    devenv "UpdateInstallerTest.vcproj", :build, "Debug"
  end
end

task :clean do
  devenv "UpdateInstaller.vcproj", :clean, "Release"
end

def devenv project, action, configuration
  sh "devenv.com", project, "/#{action}", configuration
end

def in_fixture_copy
  FileUtils.rm_rf "fixture-temp"
  FileUtils.cp_r "fixture", "fixture-temp"
  FileUtils.cd "fixture-temp" do 
    yield
  end
  FileUtils.rm_rf "fixture-temp"
end
